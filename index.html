<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Dashboard</title>
  <!-- development version, includes helpful console warnings -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/moment@2.22.0/moment.js"></script>
  <script src="https://unpkg.com/moment@2.22.0/locale/de.js"></script>

  <!-- Axios - REST Api Requesting -->
  <script src="https://unpkg.com/axios@0.18.0/dist/axios.js"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">

  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css' rel='stylesheet' />

  <link href="main.css" rel="stylesheet">
</head>
<body>
  <div id="app">
    <div id="today">
      <div class="date">{{currentDate}}</div>
      <span class="time">{{currentTime}}</span>
    </div>
    <div id="grid">
      <div v-for="tile in tiles" class="tileContainer" v-bind:class="{ big: tile.isBig }"><span class="tile"><h2>{{ tile.heading }}</h2>{{ tile.content }}<span v-html="tile.mapHtml"></span></span></div>
    </div>
  </div>
</body>
<script>
var app = new Vue({
  el: '#app',
  data: {
    currentDate: null,
    currentTime: null,
    tiles:[
      {heading: 'Public Transport', content:'', mapHtml:''},
      {heading: 'Twitter', content:'', mapHtml:''},
      {heading: 'Weather', content:'', mapHtml:''},
      {heading: 'Calendar', content:'', mapHtml:''},
      {heading: 'Pollen', content:'', mapHtml:''},
      {heading: 'Air Pollution', content:'', mapHtml:''},
      {heading: 'Traffic', content:'', mapHtml:"<div id='map'></div>", isBig: true}
    ]
  },
  methods: {
    updateCurrentDateAndTime(){
      this.currentDate = moment().format('Do MMMM YYYY');
      this.currentTime = moment().format('LTS');
    }
  },
  created() {
    moment.locale('de');
    this.currentDate = moment().format('Do MMMM YYYY');
    this.currentTime = moment().format('LTS');
    setInterval(() => this.updateCurrentDateAndTime(), 1*1000)
    axios.get('https://api.openweathermap.org/data/2.5/weather?id=2935020&appid=478ad8b9a445f3d46f7b052ab49d6a72&units=metric')
    .then(function (response) {
      console.log("Weather data: " + response.data.main.temp);
      weatherObj = app.tiles[2];
      weatherObj.content = response.data.main.temp + 'Â°C ' + response.data.weather[0].description;
      app.$set(app.tiles, 2, weatherObj);
    })
    .catch(function (error) {
      console.log(error);
    });

  }
})
</script>
<script>
// Insert accessToken and style
mapboxgl.accessToken = 'accessToken';
var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/user/styleid', //stylesheet location
    center: [13.739, 51.053], // starting position
    zoom: 9, // starting zoom
    hash: false // Add hash to fragment identifier
});
</script>
</html>
